<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Document for example create svg elements</title>
	<style>
       .start-btn {
           cursor: pointer;
			  opacity: 0.3;
       }
		 .start-text {
           /*margin: 10px;*/
		 }
	</style>
</head>
<body>

<svg id="svg_score" height="70" width="850"/>
<svg id="svg" height="500" width="850"/>

<script>

    const svgNS = "http://www.w3.org/2000/svg";


    const svg = document.getElementById("svg");
    const svgScore = document.getElementById("svg_score");

    const widthField = parseFloat(svg.getAttributeNS(null, "width"));
    const heightField = parseFloat(svg.getAttributeNS(null, "height"));

    const widthHeightBall = heightField * 0.09;

    const widthRacket = heightField * 0.03;
    const heightRacket = heightField * 0.26;


    let field = document.createElementNS(svgNS, "rect");

    field.setAttributeNS(null,"x", 0);
    field.setAttributeNS(null,"y", 0);
    field.setAttributeNS(null,"width", widthField);
    field.setAttributeNS(null,"height", heightField);
    field.setAttributeNS(null,"fill","#eee2a5");
    field.setAttributeNS(null,"stroke","black");

    svg.append(field);


    let ball = document.createElementNS(svgNS, "circle");

    // ball.setAttributeNS(null,"cx", widthField / 2 - widthHeightBall / 2);
    // ball.setAttributeNS(null,"cy", heightField / 2 - widthHeightBall / 2);
    ball.setAttributeNS(null,"r", widthHeightBall / 2);
    ball.setAttributeNS(null,"fill","#f3445b");
    ball.setAttributeNS(null,"stroke","none");

    svg.append(ball);


    let racketL = document.createElementNS(svgNS, "rect");

    // racketL.setAttributeNS(null,"x", 0);
    // racketL.setAttributeNS(null,"y", 150);
    racketL.setAttributeNS(null,"width", widthRacket);
    racketL.setAttributeNS(null,"height", heightRacket);
    racketL.setAttributeNS(null,"fill","#6cf189");
    racketL.setAttributeNS(null,"stroke","none");

    svg.append(racketL);


    let racketR = document.createElementNS(svgNS, "rect");

    // racketR.setAttributeNS(null,"x", 0);
    // racketR.setAttributeNS(null,"y", 150);
    racketR.setAttributeNS(null,"width", widthRacket);
    racketR.setAttributeNS(null,"height", heightRacket);
    racketR.setAttributeNS(null,"fill","#6c9df1");
    racketR.setAttributeNS(null,"stroke","none");

    svg.append(racketR);



    let textStart = document.createElementNS(svgNS, "text");

    textStart.setAttributeNS(null,"x", 10);
    textStart.setAttributeNS(null,"y", 40);
    textStart.setAttributeNS(null,"textLength", 80);
    textStart.setAttributeNS(null,"font-weight", 'bold');

    // textStart.setAttributeNS(null,"class", 'start-text');

    textStart.innerHTML = `START!`;

    svgScore.append(textStart);



    let button = document.createElementNS(svgNS, "rect");

    button.setAttributeNS(null,"x", 0);
    button.setAttributeNS(null,"y", 20);
    button.setAttributeNS(null,"width", 100);
    button.setAttributeNS(null,"height", 30);

    button.setAttributeNS(null,"class", 'start-btn');

    button.setAttributeNS(null,"fill","#00ff00");
    button.setAttributeNS(null,"stroke","none");

    svgScore.append(button);



    let scorePlayer1 = 0;
    let scorePlayer2 = 0;

    let textScore = document.createElementNS(svgNS, "text");

    textScore.setAttributeNS(null,"x", 370);
    textScore.setAttributeNS(null,"y", 50);
    // textScore.setAttributeNS(null,"textLength", 80);
    textScore.setAttributeNS(null,"font-size", 50);

    // textStart.setAttributeNS(null,"class", 'start-text');

    textScore.innerHTML = `<tspan class="player1">${scorePlayer1}</tspan>:<tspan class="player2">${scorePlayer2}</tspan>`;

    svgScore.append(textScore);


    player1 = document.body.querySelector('.player1');
    player2 = document.body.querySelector('.player2');








    button.addEventListener('click', startGame, {once:true});

    function startGame() {

        ballInfo.randomBall();

        timerRacket = setInterval(racketsMove, 20);

        timerBall = setInterval(ballMove, 20);

        button.disabled = true;

        // player1.innerHTML = `${scorePlayer1}`;
        // player2.innerHTML = `${scorePlayer2}`;
		  //
        // backScore.style.display = 'none';
        // backScore.style.marginLeft = '320px';
    }






    class Racket {
        constructor(_posX, _posY, _speedY, _width, _height, _racket, /*_side*/) {
            this.posX = _posX;
            this.posY = _posY;
            this.speedY = _speedY;
            this.width = _width;
            this.height = _height;
            this.racket = _racket;
            // this.side = _side;
        }
        updateRacket() {

            this.racket.setAttributeNS(null,"x", this.posX);
            this.racket.setAttributeNS(null,"y", this.posY);

            // this.racket.style[this.side] = this.posX + "px";
            // this.racket.style.top = this.posY + "px";
        }
    }

    let leftRacket = new Racket(0, 300, 10, widthRacket, heightRacket, racketL, /*'left'*/);

    let rightRacket = new Racket(widthField - widthRacket, 100, 10, widthRacket, heightRacket, racketR, /*'right'*/);


    leftRacket.updateRacket();
    rightRacket.updateRacket();



    let storage = {};

    document.addEventListener('keydown', fillStorage);
    document.addEventListener('keyup', fillStorage);

    function fillStorage(event) {

        if (event.type === 'keydown') {
            storage[event.code] = true;
        }
        if (event.type === 'keyup') {
            storage[event.code] = false;
        }
        // console.log(event.type);
        // console.log(event.code);
    }


    // let timerRacket = setInterval(racketsMove, 20);

    function racketsMove() {

        if (storage['ShiftLeft']) { /* Движение левой ракетки вверх */

            leftRacket.posY = leftRacket.posY - leftRacket.speedY;

            if (leftRacket.posY < 0) {
                leftRacket.posY = 0;
            }
            leftRacket.updateRacket();
        }

        if (storage['ControlLeft']) { /* Движение левой ракетки вниз */

            leftRacket.posY = leftRacket.posY + leftRacket.speedY;

            if (leftRacket.posY + leftRacket.height > heightField) {
                leftRacket.posY = heightField - leftRacket.height;
            }
            leftRacket.updateRacket();
        }

        if (storage['ArrowUp']) { /* Движение правой ракетки вверх */

            rightRacket.posY = rightRacket.posY - rightRacket.speedY;

            if (rightRacket.posY < 0) {
                rightRacket.posY = 0;
            }
            rightRacket.updateRacket();
        }

        if (storage['ArrowDown']) { /* Движение правой ракетки вниз */

            rightRacket.posY = rightRacket.posY + rightRacket.speedY;

            if (rightRacket.posY + rightRacket.height > heightField) {
                rightRacket.posY = heightField - rightRacket.height;
            }
            rightRacket.updateRacket();
        }
    }


    let ballInfo = {
        posX : widthField / 2 - widthHeightBall / 2,
        posY : heightField / 2 - widthHeightBall / 2,
        width : widthHeightBall,
        height: widthHeightBall,

        updateBall: function() { /* Положение мяча */
            ball.setAttributeNS(null,"cx", this.posX);
            ball.setAttributeNS(null,"cy", this.posY);

        },

        randomBall: function() {  /* Случайное направление вылета мяча */
            this.speedX = randomDirect() * 8;
            this.speedY = randomDirect() * randomDiap(2, 5);
        }
    }

    ballInfo.updateBall();

    ballInfo.randomBall();





    // let timerBall = setInterval(ballMove, 20);

    function ballMove() {

        ballInfo.posX += ballInfo.speedX; /* Изменяем положение мяча по Х */
        ballInfo.posY += ballInfo.speedY; /* Изменяем положение мяча по Y */

        /* Отскок мяча от правой ракетки */
        if (ballInfo.posX + ballInfo.width / 2 >= widthField - rightRacket.width && ballInfo.posY >= rightRacket.posY && ballInfo.posY <= rightRacket.posY + rightRacket.height) {

            ballInfo.speedX =- ballInfo.speedX;
            ballInfo.posX = widthField - ballInfo.width - rightRacket.width;

            console.log('Правая ракетка');
        }

        /* Отскок мяча от левой ракетки */
        if (ballInfo.posX <= leftRacket.width + ballInfo.width / 2 && ballInfo.posY >= leftRacket.posY && ballInfo.posY <= leftRacket.posY + leftRacket.height) {

            ballInfo.speedX =- ballInfo.speedX;
            ballInfo.posX = leftRacket.width + ballInfo.width / 2;

            console.log('Левая ракетка');
        }

        /* Вылет мяча за правую сторону поля */
        if (ballInfo.posX + ballInfo.width / 2 > widthField) {

            clearInterval(timerBall); /* Останавливаем движение мяча */

            player1.innerHTML = `${++scorePlayer1}`; /* Изменяем счет первого игрока */

            ballInfo.posX = widthField / 2 - widthHeightBall / 2; /* Устанавливаем мяч в центр поля */
            ballInfo.posY = heightField / 2 - widthHeightBall / 2;

            // timerBackScore = setInterval(startBackScore, 1000); /* Запускаем таймер обратного отсчета до начала раунда игры */

            timerRepeatRound = setTimeout(startRound, 4000); /* Запускаем таймер повторного запуска раунда игры */
        }

        /* Вылет мяча за левую сторону поля */
        if (ballInfo.posX < ballInfo.width / 2) {

            clearInterval(timerBall); /* Останавливаем движение мяча */

            player2.innerHTML = `${++scorePlayer2}`; /* Изменяем счет второго игрока */

            ballInfo.posX = widthField / 2 - widthHeightBall / 2; /* Устанавливаем мяч в центр поля */
            ballInfo.posY = heightField / 2 - widthHeightBall / 2;

            // timerBackScore = setInterval(startBackScore, 1000); /* Запускаем таймер обратного отсчета до начала раунда игры */

            timerRepeatRound = setTimeout(startRound, 4000); /* Запускаем таймер повторного запуска раунда игры */

            console.log('Левая сторона');
        }

        /* Вылет мяча за нижнюю сторону поля */
        if (ballInfo.posY + ballInfo.height / 2 > heightField) {

            ballInfo.speedY =- ballInfo.speedY;
            ballInfo.posY = heightField - ballInfo.height / 2;
        }

        /* Вылет мяча за верхнюю сторону поля */
        if (ballInfo.posY < ballInfo.height / 2) {

            ballInfo.speedY =- ballInfo.speedY;
            ballInfo.posY = ballInfo.height / 2;
        }

        /* Окончание игры и объявление победителя */
        // if (scorePlayer1 === 5 || scorePlayer2 === 5) {
        //
        //     clearTimeout(timerRepeatRound); /* Останавливаем таймер повторного запуска раунда игры */
        //     clearInterval(timerBackScore); /* Останавливаем таймер обратного отсчета до начала раунда игры */
        //     clearInterval(timerRacket); /* Останавливаем таймер для движения ракеток по игровому полю */
        //
        //     if (scorePlayer1 === 5) numPlayer = 1; /* Определяем победителя игры */
        //     if (scorePlayer2 === 5) numPlayer = 2;
        //
        //     backScore.style.display = 'inline-block'; /* Отображаем победителя игры */
        //     backScore.style.marginLeft = '140px';
        //     backScore.innerHTML = `win <span>Player ${numPlayer}</span>`;
        //
        //     button.disabled = false; /* Активируем возможность старта новой игры */
        //
        //     scorePlayer1 = 0; /* Обнуляем счет игры */
        //     scorePlayer2 = 0;
        // }

        /* Функция для повторного запуска раунда игры */
        function startRound() {

            ballInfo.randomBall(); /* Обновляем случайное направление вылета мяча */

            timerBall = setInterval(ballMove, 20); /* Повторно запускаем таймер для движения мяча по игровому полю */
        }

        ballInfo.updateBall(); /* Обновляем положение мяча на игровом поле */
    }


















    function randomDirect() { /* Функция для определения случайного направления вылета мяча */
        let x = Math.random();
        if (x < 0.5) x = -1;
        else x = 1;
        return x;
    }

    function randomDiap(n,m) { /* Функция для определения случайного угла вылета мяча */
        return Math.floor(Math.random() * (m - n + 1)) + n;
    }




</script>

</body>
</html>